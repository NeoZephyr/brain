## 数据页

![[Pasted image 20230305220944.png]]

各个数据页组成一个双向链表，每个数据页中的记录按照主键顺序组成单向链表；每一个数据页中有一个页目录，方便按照主键查询记录。页目录通过槽把记录分成不同的小组，每个小组有若干条记录。按照主键搜索页中记录时，可以采用二分法快速搜索，无需从最小记录开始遍历整个页中的记录链表

## 索引

### B+ 树

![[Pasted image 20230305221005.png]]

B+ 树特点：

1. 最底层的节点叫作叶子节点，用来存放数据
2. 其他上层节点叫作非叶子节点，仅用来存放目录项，作为索引
3. 非叶子节点分为不同层次，通过分层来降低每一层的搜索量
4. 所有节点按照索引键大小排序，构成一个双向链表，加速范围查找

### 聚簇索引

InnoDB 使用 B+ 树，叶子节点中保存实际数据，就是聚簇索引
InnoDB 会自动使用主键作为聚簇索引的索引键（如果没有主键，就选择第一个不包含 NULL 值的唯一列）

### 二级索引

InnoDB 使用 B+ 树，叶子节点中保存主键，就是二级索引
查询时，先获得主键值，然后去聚簇索引中获得数据行。这个过程就叫作回表

![[Pasted image 20230305221035.png]]

### 索引维护

#### 页分裂与合并

数据页中的记录都是按照索引值从小到大的顺序存放的，新增记录就需要往页中插入数据，现有的页满了就需要新创建一个页，把现有页的部分数据移过去，这就是页分裂；如果删除了许多数据使得页比较空闲，还需要进行页合并。页分裂和合并，都会有 IO 代价，并且可能在操作过程中产生死锁

#### 空间占用

二级索引不保存原始数据，但要保存索引列的数据，所以会占用更多的空间

```sql
select TABLE_NAME, DATA_LENGTH, INDEX_LENGTH from information_schema.TABLES;
```