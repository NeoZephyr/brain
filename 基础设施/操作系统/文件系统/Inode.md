## inode 与块的存储

硬盘分成相同大小的单元，称为块（Block）。一块的大小是扇区大小的整数倍，默认是 4K。在格式化的时候，这个值是可以设定的

由于硬盘被分成了一个个小的块，在存放文件的时候，就不用再分配一块连续的空间了，可以分散成一个个小块进行存放。这样比较容易添加、删除和插入数据

但是这也带来一个新的问题，那就是文件的数据存放得太散，找起来就比较困难。文件系统使用 inode 结构来进行索引，每个文件都会对应一个 inode；一个文件夹就是一个文件，也对应一个 inode

inode 的 block 数组存放文件块信息。在 ext2 和 ext3 中，其中前 12 项直接保存了块的位置，也就是说，可以通过 `block[0-11]`，直接得到保存文件内容的块

如果一个文件比较大，12 块放不下。这时，可以让 `block[12]` 指向一个块，这个块里面不放数据块，而是放数据块的位置，这个块称为间接块。也就是说，通过 `block[12]` 找到间接块后，再根据间接块找到数据块

![[Pasted image 20230219001618.png]]

ext4 引入了 Extents 概念。比方说，一个文件大小为 128M，如果使用 4k 大小的块进行存储，需要 32k 个块。如果按照 ext2 或者 ext3 那样存放，数量太大了。但是 Extents 可以用于存放连续的块，也就是说，可以把 128M 放在一个 Extents 里面。这样，对大文件的读写性能提高了，文件碎片也减少了

![[Pasted image 20230219001724.png]]
